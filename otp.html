<html>
<head>
  <title>OTP</title>
  <script type="text/javascript">/* <![CDATA[ */
    var encode_chars = new Array();
    encode_chars['A'] = '1';
    encode_chars['E'] = '2';
    encode_chars['I'] = '3';
    encode_chars['N'] = '4';
    encode_chars['O'] = '5';
    encode_chars['R'] = '6';
    encode_chars['B'] = '70';
    encode_chars['C'] = '71';
    encode_chars['D'] = '72';
    encode_chars['F'] = '73';
    encode_chars['G'] = '74';
    encode_chars['H'] = '75';
    encode_chars['J'] = '76';
    encode_chars['K'] = '77';
    encode_chars['L'] = '78';
    encode_chars['M'] = '79';
    encode_chars['P'] = '80';
    encode_chars['Q'] = '81';
    encode_chars['S'] = '82';
    encode_chars['T'] = '83';
    encode_chars['U'] = '84';
    encode_chars['V'] = '85';
    encode_chars['W'] = '86';
    encode_chars['X'] = '87';
    encode_chars['Y'] = '88';
    encode_chars['Z'] = '89';
    encode_chars[' '] = '90';
    encode_chars['.'] = '91';
    encode_chars[','] = '92';
    encode_chars[':'] = '93';
    encode_chars['?'] = '94';
    encode_chars['/'] = '95';
    encode_chars['('] = '96';
    encode_chars[')'] = '97';
    encode_chars['"'] = '98';
    encode_chars['!'] = '99';
    encode_chars['0'] = '00';
    encode_chars['1'] = '01';
    encode_chars['2'] = '02';
    encode_chars['3'] = '03';
    encode_chars['4'] = '04';
    encode_chars['5'] = '05';
    encode_chars['6'] = '06';
    encode_chars['7'] = '07';
    encode_chars['8'] = '08';
    encode_chars['9'] = '09';
    var decode_chars = new Array();
    var decode_tidyup = new Array();
    decode_chars['1'] = 'A';
    decode_chars['2'] = 'E';
    decode_chars['3'] = 'I';
    decode_chars['4'] = 'N';
    decode_chars['5'] = 'O';
    decode_chars['6'] = 'R';
    decode_chars['70'] = 'B';
    decode_chars['71'] = 'C';
    decode_chars['72'] = 'D';
    decode_chars['73'] = 'F';
    decode_chars['74'] = 'G';
    decode_chars['75'] = 'H';
    decode_chars['76'] = 'J';
    decode_chars['77'] = 'K';
    decode_chars['78'] = 'L';
    decode_chars['79'] = 'M';
    decode_chars['80'] = 'P';
    decode_chars['81'] = 'Q';
    decode_chars['82'] = 'S';
    decode_chars['83'] = 'T';
    decode_chars['84'] = 'U';
    decode_chars['85'] = 'V';
    decode_chars['86'] = 'W';
    decode_chars['87'] = 'X';
    decode_chars['88'] = 'Y';
    decode_chars['89'] = 'Z';
    decode_chars['90'] = ' ';
    decode_chars['91'] = '.';
    decode_chars['92'] = ',';
    decode_chars['93'] = ':';
    decode_chars['94'] = '?';
    decode_chars['95'] = '/';
    decode_chars['96'] = '(';
    decode_chars['97'] = ')';
    decode_chars['98'] = '"';
    decode_chars['99'] = '!';
    decode_chars['00'] = '###zero###'; decode_tidyup['###zero###'] = '0';
    decode_chars['01'] = '###one###'; decode_tidyup['###one###'] = '1';
    decode_chars['02'] = '###two###'; decode_tidyup['###two###'] = '2';
    decode_chars['03'] = '###three###'; decode_tidyup['###three###'] = '3';
    decode_chars['04'] = '###four###'; decode_tidyup['###four###'] = '4';
    decode_chars['05'] = '###five###'; decode_tidyup['###five###'] = '5';
    decode_chars['06'] = '###six###'; decode_tidyup['###six###'] = '6';
    decode_chars['07'] = '###seven###'; decode_tidyup['###seven###'] = '7';
    decode_chars['08'] = '###eight###'; decode_tidyup['###eight###'] = '8';
    decode_chars['09'] = '###nine###'; decode_tidyup['###nine###'] = '9';
    var common_words = 'able,about,above,act,add,afraid,after,again,against,age,ago,agree,air,all,allow,also,always,among,and,anger,animal,answer,any,appear,apple,are,area,arm,arrange,arrive,art,ask,atom,' +
    'baby,back,bad,ball,band,bank,bar,base,basic,bat,bear,beat,beauty,bed,been,before,began,begin,behind,believe,bell,best,better,between,big,big,bit,black,block,blood,blow,blue,board,boat,body,bone,book,born,both,bottom,bought,box,boy,branch,bread,break,bright,bring,broad,broke,brother,brought,brown,build,burn,busy,but,buy,' +
    'call,came,camp,can,capital,captain,car,card,care,carry,case,cat,catch,caught,cause,cell,cent,center,century,certain,chair,chance,change,character,charge,chart,check,chick,chief,child,children,choose,chord,circle,city,claim,class,clean,clear,climb,clock,close,clothe,cloud,coast,coat,cold,collect,colony,colour,column,come,common,company,compare,complete,condition,connect,consider,consonant,contain,continent,continue,control,cook,cool,copy,corn,corner,correct,cost,cotton,could,count,country,course,cover,cow,crease,create,crop,cross,crowd,cry,current,cut,' +
    'dad,dance,danger,dark,day,dead,deal,dear,death,decide,decimal,deep,degree,depend,describe,desert,design,determine,develop,dictionary,did,die,differ,difficult,direct,discuss,distant,divide,division,doctor,does,dog,dollar,don\'t,done,door,double,down,draw,dream,dress,drink,drive,drop,dry,duck,during,' +
    'each,ear,early,earth,ease,east,eat,edge,effect,egg,eight,either,electric,element,else,end,enemy,energy,engine,enough,enter,equal,equate,especially,even,evening,event,ever,every,exact,example,except,excite,exercise,expect,experience,experiment,eye,' +
    'face,fact,fair,fall,family,famous,far,farm,fast,fat,father,favour,fear,feed,feel,feet,fell,felt,few,field,fig,fight,figure,fill,final,find,fine,finger,finish,fire,first,fish,fit,five,flat,floor,flow,flower,fly,follow,food,foot,for,force,forest,form,forward,found,four,fraction,free,fresh,friend,from,front,fruit,full,fun,' +
    'game,garden,gas,gather,gave,general,gentle,get,girl,give,glad,glass,go,gold,gone,good,got,govern,grand,grass,grey,great,green,grew,ground,group,grow,guess,guide,gun,' +
    'had,hair,half,hand,happen,happy,hard,has,hat,have,head,hear,heard,heart,heat,heavy,held,help,her,here,high,hill,him,his,history,hit,hold,hole,home,hope,horse,hot,hour,house,how,huge,human,hundred,hunt,hurry,' +
    'ice,idea,imagine,inch,include,indicate,industry,insect,instrument,interest,invent,iron,island,' +
    'job,join,joy,jump,just,' +
    'keep,kept,key,kill,kind,king,knew,know,' +
    'lady,lake,land,language,large,last,late,laugh,law,lay,lead,learn,least,leave,led,left,leg,length,less,let,letter,level,lie,life,lift,light,like,line,liquid,list,listen,little,live,locate,log,lone,long,look,lost,lot,loud,love,low,' +
    'machine,made,magnet,main,major,make,man,many,map,mark,market,mass,master,match,material,matter,may,mean,meant,measure,meat,meet,melody,men,metal,method,middle,might,mile,milk,million,mind,mine,minute,miss,mix,modern,molecule,moment,money,month,moon,more,morning,most,mother,motion,mount,mountain,mouth,move,much,multiply,music,must,' +
    'name,nation,natural,nature,near,necessary,neck,need,neighbour,never,new,next,night,nine,noise,noon,nor,north,nose,note,nothing,notice,noun,now,number,' +
    'object,observe,occur,ocean,off,offer,office,often,oil,old,once,one,only,open,operate,opposite,order,organ,original,other,our,out,over,own,oxygen,' +
    'page,paint,pair,paper,paragraph,parent,part,particular,party,pass,past,path,pattern,pay,people,perhaps,period,person,phrase,pick,picture,piece,pitch,place,plain,plan,plane,planet,plant,play,please,plural,poem,point,poor,populate,port,pose,position,possible,post,pound,power,practice,prepare,present,press,pretty,print,probable,problem,process,produce,product,proper,property,protect,prove,provide,pull,push,put,' +
    'quart,question,quick,quiet,quite,quotient,' +
    'race,radio,rail,rain,raise,ran,range,rather,reach,read,ready,real,reason,receive,record,red,region,remember,repeat,reply,represent,require,rest,result,rich,ride,right,ring,rise,river,road,rock,roll,room,root,rope,rose,round,row,rub,rule,run,' +
    'safe,said,sail,salt,same,sand,sat,save,saw,say,scale,school,science,score,sea,search,season,seat,second,section,see,seed,seem,segment,select,self,sell,send,sense,sent,sentence,separate,serve,set,settle,seven,several,shall,shape,share,sharp,she,sheet,shell,shine,ship,shoe,shop,shore,short,should,shoulder,shout,show,side,sight,sign,silent,silver,similar,simple,since,sing,single,sister,sit,six,size,skill,skin,sky,slave,sleep,slip,slow,small,smell,smile,snow,soft,soil,soldier,solution,solve,some,son,song,soon,sound,south,space,speak,special,speech,speed,spell,spend,spoke,spot,spread,spring,square,stand,star,start,state,station,stay,stead,steam,steel,step,stick,still,stone,stood,stop,store,story,straight,strange,stream,street,stretch,string,strong,student,study,subject,substance,subtract,success,such,sudden,suffix,sugar,suggest,suit,summer,sun,supply,support,sure,surface,surprise,swim,syllable,symbol,system,' +
    'table,tail,take,talk,tall,teach,team,teeth,tell,temperature,ten,term,test,than,thank,that,the,their,them,then,there,these,they,thick,thin,thing,think,third,this,those,though,thought,thousand,three,through,throw,thus,tie,time,tiny,tire,together,told,tone,took,tool,top,total,touch,toward,town,track,trade,train,travel,tree,triangle,trip,trouble,truck,true,try,tube,turn,twenty,two,type,' +
    'under,unit,until,use,usual,' +
    'valley,value,vary,verb,very,view,village,visit,voice,vowel,' +
    'wait,walk,wall,want,war,warm,was,wash,watch,water,wave,way,wear,weather,week,weight,well,went,were,west,what,wheel,when,where,whether,which,while,white,who,whole,whose,why,wide,wife,wild,will,win,wind,window,wing,winter,wire,wish,with,woman,women,won\'t,wonder,wood,word,work,world,would,write,written,wrong,wrote,' +
    'yard,year,yellow,yes,yet,you,young,your';
    
    var random_otp_warning_given = false;    
    function random_otp() {
      var otp = '';
      for(var i = 0; i < 91; i++) {
        for(var j = 0; j < 5; j++) {
          otp += Math.floor(Math.random()*10);
        }
        if(i < 90) otp += ' ';
      }
      document.getElementById('otp').value = otp;
      if(!random_otp_warning_given) {
        alert('A pseudorandom OTP has been generated. THIS IS NOT SUITABLE FOR ACTUAL CRYPTOGRAPHIC USE (see blog post linked below for an explanation).');
        random_otp_warning_given = true;
      }
    }
    
    function encrypt() {
      // load vars and sanity check
      var input = document.getElementById('input').value.toUpperCase();
      var otp = document.getElementById('otp').value.replace(/[ \n]/g, '');
      if (!otp.match(/^[0-9]+$/)) {
        alert('Invalid OTP specified. OTP should consist of one or more numeric digits, usually in blocks of five digits seperated by spaces.')
        return false;
      }
      
       // numeralise input
      var numeralise = '';
      for (var i = 0; i < input.length; i++) {
        var str_len = 1;
        var push_i = 1;
        if((this_number = encode_chars[(character = input.charAt(i))]) == undefined) {
          alert("Encoding table does not specify an encoding for '" + character + "'. It has been replaced with '.'");
          this_number = encode_chars[(character = '.')];
        }
        
        // extend to a multiple of 5 chars
      var extend_by = (5 - (numeralise.length % 5)) % 5;
      for (var i = 0; i < extend_by; i++) {
        numeralise += '0';
      }
      // check otp length
      if ((too_short = numeralise.length - otp.length) > 0) {
        if(confirm('Your OTP is too short to encode this message (needs ' + too_short + ' more digits). You can continue to encrypt, but your encryption will be imperfect and could be cracked. Do you want to continue?')) {
          // multiply otp length
          while(otp.length < numeralise.length) otp += otp;
        } else {
          return false;
        }
      }
      // encrypt
      var output = '';
      for (var i = 0; i < numeralise.length; i++) {
        var num = parseInt(numeralise.charAt(i)) - parseInt(otp.charAt(i));
        if(num < 0) num += 10
        output += num;
      }
      // break output with spaces
      var output_split = '';
      for(var i = 0; i < output.length; i += 5) {
        output_split += output.substr(i, 5) + ' ';
      }
      
      // display output
      document.getElementById('output').value = output_split;
    }
    
    
    function decrypt() {
      var input = document.getElementById('input').value.replace(/[ \n]/g, '');
      var otp = document.getElementById('otp').value.replace(/[ \n]/g, '');
      // load vars and sanity check
      if (!input.match(/^[0-9]+$/)) {
        alert('Invalid input supplied. Input should consist of one or more numeric digits, usually in blocks of five digits seperated by spaces.')
        return false;
      }
      if (!otp.match(/^[0-9]+$/)) {
        alert('Invalid OTP specified. OTP should consist of one or more numeric digits, usually in blocks of five digits seperated by spaces.')
        return false;
      }
      // check otp length
      if ((too_short = input.length - otp.length) > 0) {
        alert('Your OTP is too short to be a complete key for this message (needs ' + too_short + ' more digits). This OTP could be correct, but if it is, the key may have been broken and the message intercepted.')
        while(otp.length < input.length) otp += otp;
      }
      // decrypt
      var output = '';
      for (var i = 0; i < input.length; i++) {
        var num = parseInt(input.charAt(i)) + parseInt(otp.charAt(i));
        if(num > 9) num -= 10
        output += num;
      }
      
      // denumeralise
      var output_denum = '';
      var pos = 0;
      var len = 1;
      while(pos + len <= output.length) {
        var chars = output.substr(pos,len);
        if((decode_char = decode_chars_and_codebook[chars]) != undefined) {
          output_denum += decode_char;
          pos += len;
          len = 1;
        } else {
          len++;
        }
      }
      // fix numbers etc.
      for (var key in decode_tidyup) {
        var value = decode_tidyup[key];
        output_denum = output_denum.replace(new RegExp(key, 'g'), value);
      }
      // display output
      document.getElementById('output').value = output_denum;
    }
    
    
    function start_otp() {
      var page_content  = '<h1>One-Time Pad Encoder/Decoder In Javascript</h1>';
      var count = 1000;
      var common_array = common_words.split(',');
      for(var i in common_array) {
        page_content += '' + count + ' - ' + common_array[i] + '\n';
        count++;
      }
      page_content += '</textarea></p></div><div id="otp_panel"><p>Input:<br /><textarea id="input">99113 59099 11290</textarea></p><p>OTP:<br /><textarea id="otp">00000 00000 00000</textarea></p><p><input type="button" value="Encrypt" onclick="encrypt();" /> <input type="button" value="Decrypt" onclick="decrypt();" /> <input type="button" value="Generate Pseudorandom OTP" onclick="random_otp();" /></p><p>Output:<br /><textarea id="output"></textarea></p></div>';
      page_content += '<h3>Encoding</h3><ol><li>Put your codebook into the <em>Codebook:</em> field, or use the default.</li><li>Put your plaintext message into the <em>Input:</em> field.</li><li>Put your key into the <em>OTP:</em> field. Each key must be securely generated, known only to the communicating parties, and never be reused.</li><li>Press the <strong>Encrypt</strong> button. Your ciphertext appears in the <em>Output:</em> box.</li></ol>';
      page_content += '<h3>Decoding</h3><ol><li>Put your codebook into the <em>Codebook:</em> field, or use the default.</li><li>Put the encrypted message into the <em>Input:</em> field.</li><li>Put your key into the <em>OTP:</em> field. The key must be identical to the one used by the message sender.</li><li>Press the <strong>Decrypt</strong> button. Your plaintext appears in the <em>Output:</em> box. In some cases, this will be padded with trailing zeroes (0) as a result of the algorithm used.</li></ol>';
      document.body.innerHTML = page_content;
    }
      
 /* ]]> */</script>
 <style type="text/css">
    div#otp_panel {
      width: 60%;
      padding-right: 0.5 em;
    }
    
    textarea {
      width: 90%;
      border: 1 px solid #555;
    }
  
    div#otp_panel textarea {
      height: 10 em;
    }
  </style>
</head>
<body onload="start_otp();">
  Loading OTP.<br />
  If this message doesn't go away, you may need to enable Javascript in your web browser, or perhaps there's a bug. ;-)
</body>
